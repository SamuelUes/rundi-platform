(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51993,e=>{"use strict";e.s(["typography",0,{h1:"text-2xl font-semibold",h2:"text-sm font-semibold",body:"text-sm",bodyMuted:"text-xs"}])},36903,e=>{"use strict";var s=e.i(43476),t=e.i(71645);e.i(51718);var a=e.i(18357),i=e.i(746),r=e.i(8277),o=e.i(51993);function d(e){if(!e)return"N/D";let s=new Date(e);return Number.isNaN(s.getTime())?e:s.toLocaleString()}function l(e){return null===e?"N/D":`${e.toFixed(2)} C$`}function n(){let[e,n]=(0,t.useState)([]),[c,m]=(0,t.useState)(!0),[x,h]=(0,t.useState)(null),[p,u]=(0,t.useState)(""),[j,y]=(0,t.useState)("createdAt"),[N,f]=(0,t.useState)("desc");(0,t.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(i.firebaseAuth,async e=>{if(!e){h("Sesión no encontrada."),m(!1);return}try{let s=await e.getIdToken(),t=await fetch("/api/admin/payments",{headers:{Authorization:`Bearer ${s}`}});if(!t.ok){let e=(await t.json().catch(()=>({}))).error||"Error al cargar pagos.";h(e),m(!1);return}let a=await t.json();n(a.payments||[]),m(!1)}catch(e){h("Error al comunicar con el servidor."),m(!1)}});return()=>e()},[]);let g=(0,t.useMemo)(()=>{let s=p.trim().toLowerCase();return[...s?e.filter(e=>[e.id,e.rideId,e.status,e.commissionStatus,e.paymentMethod,e.paymentProvider,e.localTransactionId,e.localAuthorizationCode,e.localBank,e.cancelReason].filter(Boolean).join(" ").toLowerCase().includes(s)):e].sort((e,s)=>{let t=v(e,j),a=v(s,j);if(t===a)return 0;if(null==t)return"asc"===N?1:-1;if(null==a)return"asc"===N?-1:1;if("number"==typeof t&&"number"==typeof a)return"asc"===N?t-a:a-t;let i=String(t).toLowerCase(),r=String(a).toLowerCase();if(i===r)return 0;let o=i<r?-1:1;return"asc"===N?o:-o})},[e,p,j,N]);function v(e,s){if("id"===s)return e.id;if("rideId"===s)return e.rideId??null;if("status"===s)return e.status??null;if("amount"===s)return e.amount??null;let t="createdAt"===s?e.createdAt:"paidAt"===s?e.paidAt:e.commissionPaidAt;if(!t)return null;let a=new Date(t).getTime();return Number.isNaN(a)?null:a}function C(e,t){let a=j===e&&"asc"===N,i=j===e&&"desc"===N,o="leading-none text-[10px]";return(0,s.jsxs)("span",{className:"ml-1 flex flex-col",children:[(0,s.jsx)("button",{type:"button","aria-label":`Orden ascendente por ${t}`,className:`${o} ${a?r.themeColors.textPrimary:r.themeColors.textMuted}`,onClick:()=>{y(e),f("asc")},children:"▲"}),(0,s.jsx)("button",{type:"button","aria-label":`Orden descendente por ${t}`,className:`${o} ${i?r.themeColors.textPrimary:r.themeColors.textMuted}`,onClick:()=>{y(e),f("desc")},children:"▼"})]})}return(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("header",{className:"space-y-1",children:[(0,s.jsx)("h1",{className:`${o.typography.h1} ${r.themeColors.textPrimary}`,children:"Pagos"}),(0,s.jsx)("p",{className:`${o.typography.body} ${r.themeColors.textSecondary}`,children:"Historial de pagos registrados en Supabase (tabla payments)."})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("input",{type:"search",value:p,onChange:e=>u(e.target.value),placeholder:"Buscar por ID de pago, viaje, estado o banco",className:`w-full rounded-md border px-3 py-2 text-sm outline-none ring-0 ${r.themeColors.surface} ${r.themeColors.inputBorder} ${r.themeColors.textPrimary}`}),(0,s.jsx)("p",{className:`mt-1 text-xs ${r.themeColors.textMuted}`,children:"La búsqueda aplica sobre: ID de pago, ID de viaje, estado, método y proveedor de pago, banco y códigos de autorización."})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-1 text-right",children:[(0,s.jsxs)("p",{className:`text-xs font-medium ${r.themeColors.textSecondary}`,children:["Total: ",g.length," pagos"]}),(0,s.jsx)("p",{className:`text-[11px] ${r.themeColors.textMuted}`,children:"Usa las flechas de cada columna para ordenar."})]})]}),c&&(0,s.jsx)("p",{className:`${o.typography.body} ${r.themeColors.textSecondary}`,children:"Cargando pagos..."}),!c&&x&&(0,s.jsx)("p",{className:`${o.typography.body} ${r.themeColors.dangerText}`,children:x}),!c&&!x&&(0,s.jsx)("div",{className:"overflow-x-auto rounded-xl border border-zinc-100 bg-white shadow-sm",children:(0,s.jsxs)("table",{className:"min-w-full text-left text-[13px]",children:[(0,s.jsx)("thead",{className:`${r.themeColors.appBackground}`,children:(0,s.jsxs)("tr",{className:"text-[11px] uppercase tracking-wide text-zinc-500",children:[(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"Pago"}),C("id","ID de pago")]})}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"Viaje"}),C("rideId","ID de viaje")]})}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"Estado"}),C("status","estado")]})}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-10",children:[(0,s.jsx)("span",{children:"Montos"}),C("amount","monto")]})}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:"Comisión"}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:"Método / Banco"}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:"Verificaciones"}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"Creado"}),C("createdAt","fecha de creación")]})}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"Pagado"}),C("paidAt","fecha de pago")]})}),(0,s.jsx)("th",{className:"px-3 py-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"Comisión pagada"}),C("commissionPaidAt","fecha de comisión pagada")]})})]})}),(0,s.jsx)("tbody",{children:g.map(e=>(0,s.jsxs)("tr",{className:"border-b border-zinc-100 last:border-0 odd:bg-zinc-50/60",children:[(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textPrimary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsx)("div",{className:"font-semibold text-sm",children:e.id}),e.localTransactionId&&(0,s.jsxs)("div",{className:r.themeColors.textMuted,children:["Tx: ",e.localTransactionId]}),e.localAuthorizationCode&&(0,s.jsxs)("div",{className:r.themeColors.textMuted,children:["Auth: ",e.localAuthorizationCode]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("div",{children:["Viaje: ",e.rideId||"(sin viaje)"]}),(0,s.jsxs)("div",{children:["Banco: ",e.localBank||"N/D"]}),(0,s.jsxs)("div",{children:["Proveedor: ",e.paymentProvider||"N/D"]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("div",{children:["Estado: ",e.status||"N/D"]}),e.cancelReason&&(0,s.jsxs)("div",{className:r.themeColors.textMuted,children:["Motivo: ",e.cancelReason]}),(0,s.jsxs)("div",{children:["Sync Firebase: ",e.syncedToFirebase?"Sí":"No"]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top font-semibold ${r.themeColors.textSecondary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("div",{children:["Monto: ",l(e.amount)]}),(0,s.jsxs)("div",{children:["Propina: ",l(e.tip)]}),(0,s.jsxs)("div",{children:["Total: ",l(e.total)]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("div",{children:["Comisión: ",l(e.commission)]}),(0,s.jsxs)("div",{children:["Tasa aplicada: ",e.commissionRateApplied??"N/D"]}),(0,s.jsxs)("div",{children:["Estatus: ",e.commissionStatus||"N/D"]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("div",{children:["Método: ",e.paymentMethod||"N/D"]}),(0,s.jsxs)("div",{children:["Proveedor: ",e.paymentProvider||"N/D"]}),(0,s.jsxs)("div",{children:["Banco: ",e.localBank||"N/D"]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("div",{children:["Biometría: ",e.biometricAuthenticated?"Sí":"No"]}),(0,s.jsxs)("div",{children:["SMS verificado: ",e.smsCodeVerified?"Sí":"No"]}),(0,s.jsxs)("div",{children:["Método auth: ",e.authenticationMethod||"N/D"]})]})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsx)("div",{className:"text-xs font-medium",children:d(e.createdAt)})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsx)("div",{className:"text-xs font-medium",children:d(e.paidAt)})}),(0,s.jsx)("td",{className:`px-3 py-2 align-top ${r.themeColors.textSecondary}`,children:(0,s.jsx)("div",{className:"text-xs font-medium",children:d(e.commissionPaidAt)})})]},e.id))})]})})]})}e.s(["default",()=>n])}]);